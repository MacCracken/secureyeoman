# ADR 048: Accepted Risk — ESLint ajv ReDoS Vulnerability (GHSA-2g4f-4pwh-qvx6)

**Status**: Accepted

**Date**: 2026-02-17

---

## Context

`npm audit` reports 12 moderate-severity vulnerabilities (GHSA-2g4f-4pwh-qvx6) in `ajv < 8.18.0`. All 12 are traced to ESLint's internal dependency chain:

```
ajv@6.12.6
└── @eslint/eslintrc
└── eslint
    └── @eslint-community/eslint-utils
        └── @typescript-eslint/utils
            └── @typescript-eslint/eslint-plugin
            └── typescript-eslint
```

The vulnerability is a **ReDoS (Regular Expression Denial of Service)** that triggers only when the `$data` option is used in an ajv schema. ESLint does not use `$data` references in its internal schema validation, nor does any code path in this project pass untrusted input to ESLint's ajv instance.

### Why the standard fix is not applicable

The advisory suggests `npm audit fix --force`, which would downgrade `typescript-eslint` to `8.14.0`. This is a breaking change that would introduce regressions in type-aware lint rules. We attempted an alternative using npm `overrides`:

```json
"overrides": { "ajv": "^8.18.0" }
```

This approach fails because ESLint 9.x explicitly depends on the ajv 6.x API. Forcing ajv 8 into ESLint's dependency graph breaks ESLint's internal schema compilation — npm correctly flags the resolved packages as `invalid`. The override was reverted.

### Attack surface assessment

| Factor | Assessment |
|--------|-----------|
| Package type | Dev dependency — never shipped to end users |
| Trigger condition | `$data` option in ajv schema — not used by ESLint |
| Attacker access required | Write access to ESLint config or schema files |
| Runtime exposure | None — only runs during local `npm run lint` |
| Exploitability | Effectively zero in this context |

---

## Decision

**Accept the risk** and wait for upstream resolution.

The vulnerability exists exclusively in dev tooling that is never included in production builds or deployed artifacts. The attack surface is non-existent: the `$data` trigger path is not reachable through normal ESLint usage, and only a developer with existing write access to the repository could theoretically craft an exploit — at which point they already have far more impactful attack vectors available.

Do not use `--force` downgrade. Do not attempt `overrides` for `ajv`. Monitor upstream releases of `eslint` and `typescript-eslint` for a proper patch.

---

## Consequences

### Positive

- **Toolchain stability**: No breaking changes to `typescript-eslint` or the lint rule configuration.
- **Clean audit reasoning**: The decision is documented with rationale rather than silently ignored.

### Negative / Trade-offs

- **`npm audit` will report 12 moderate findings** until upstream ships a fix. This is expected and accepted. The `security:audit` script uses `--audit-level=moderate`, so CI will continue to surface this — intentionally, as a reminder to recheck on dependency updates.
- **Maintenance obligation**: This ADR must be revisited when ESLint or typescript-eslint releases a version that resolves the ajv dependency. See [Dependency Watch](#dependency-watch) in the roadmap.

---

## Resolution Criteria

This ADR is superseded when any of the following occur:

1. `eslint` releases a version that internally upgrades to `ajv >= 8.18.0`
2. `typescript-eslint` releases a non-breaking upgrade path that pulls in a patched ESLint
3. The ajv 6.x line receives a backported patch for GHSA-2g4f-4pwh-qvx6

At that point: run `npm update eslint typescript-eslint`, verify `npm audit` reports zero findings, and close this ADR as **Superseded**.

---

## Related

- [GHSA-2g4f-4pwh-qvx6](https://github.com/advisories/GHSA-2g4f-4pwh-qvx6) — ajv ReDoS advisory
- [ADR 027: Gateway Security Hardening](./027-gateway-security-hardening.md)
- [Security Model — Accepted Risk Vulnerabilities](../security/security-model.md#accepted-risk-dev-dependency-vulnerabilities)
- [Roadmap Dependency Watch](../development/roadmap.md#dependency-watch)

{{- if .Values.externalSecrets.enabled }}
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: {{ include "secureyeoman.fullname" . }}-secrets
  namespace: {{ include "secureyeoman.namespace" . }}
  labels:
    {{- include "secureyeoman.labels" . | nindent 4 }}
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: {{ include "secureyeoman.fullname" . }}-secret-store
    kind: ClusterSecretStore
  target:
    name: {{ include "secureyeoman.fullname" . }}-secrets
    creationPolicy: Owner
  data:
    - secretKey: POSTGRES_PASSWORD
      remoteRef:
        {{- if eq .Values.externalSecrets.provider "aws" }}
        key: {{ .Values.externalSecrets.aws.secretName }}
        property: POSTGRES_PASSWORD
        {{- else if eq .Values.externalSecrets.provider "gcp" }}
        key: {{ .Values.externalSecrets.gcp.secretName }}
        property: POSTGRES_PASSWORD
        {{- else if eq .Values.externalSecrets.provider "azure" }}
        key: POSTGRES-PASSWORD
        {{- end }}
    - secretKey: GITHUB_OAUTH_CLIENT_ID
      remoteRef:
        {{- if eq .Values.externalSecrets.provider "aws" }}
        key: {{ .Values.externalSecrets.aws.secretName }}
        property: GITHUB_OAUTH_CLIENT_ID
        {{- else if eq .Values.externalSecrets.provider "gcp" }}
        key: {{ .Values.externalSecrets.gcp.secretName }}
        property: GITHUB_OAUTH_CLIENT_ID
        {{- else if eq .Values.externalSecrets.provider "azure" }}
        key: GITHUB-OAUTH-CLIENT-ID
        {{- end }}
    - secretKey: GITHUB_OAUTH_CLIENT_SECRET
      remoteRef:
        {{- if eq .Values.externalSecrets.provider "aws" }}
        key: {{ .Values.externalSecrets.aws.secretName }}
        property: GITHUB_OAUTH_CLIENT_SECRET
        {{- else if eq .Values.externalSecrets.provider "gcp" }}
        key: {{ .Values.externalSecrets.gcp.secretName }}
        property: GITHUB_OAUTH_CLIENT_SECRET
        {{- else if eq .Values.externalSecrets.provider "azure" }}
        key: GITHUB-OAUTH-CLIENT-SECRET
        {{- end }}
    - secretKey: GOOGLE_OAUTH_CLIENT_ID
      remoteRef:
        {{- if eq .Values.externalSecrets.provider "aws" }}
        key: {{ .Values.externalSecrets.aws.secretName }}
        property: GOOGLE_OAUTH_CLIENT_ID
        {{- else if eq .Values.externalSecrets.provider "gcp" }}
        key: {{ .Values.externalSecrets.gcp.secretName }}
        property: GOOGLE_OAUTH_CLIENT_ID
        {{- else if eq .Values.externalSecrets.provider "azure" }}
        key: GOOGLE-OAUTH-CLIENT-ID
        {{- end }}
    - secretKey: GOOGLE_OAUTH_CLIENT_SECRET
      remoteRef:
        {{- if eq .Values.externalSecrets.provider "aws" }}
        key: {{ .Values.externalSecrets.aws.secretName }}
        property: GOOGLE_OAUTH_CLIENT_SECRET
        {{- else if eq .Values.externalSecrets.provider "gcp" }}
        key: {{ .Values.externalSecrets.gcp.secretName }}
        property: GOOGLE_OAUTH_CLIENT_SECRET
        {{- else if eq .Values.externalSecrets.provider "azure" }}
        key: GOOGLE-OAUTH-CLIENT-SECRET
        {{- end }}
{{- end }}

{{- if and .Values.migration.hookEnabled (not .Values.externalSecrets.enabled) }}
# Pre-install hook Secret for the migrate Job. Created at hook-weight -10,
# before the migrate Job (weight -5), so the Job can reference it via envFrom.
# Deleted after the hook succeeds; the regular chart Secret (secret.yaml)
# is created as a normal resource afterwards.
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "secureyeoman.fullname" . }}-migrate-secrets
  namespace: {{ include "secureyeoman.namespace" . }}
  labels:
    {{- include "secureyeoman.labels" . | nindent 4 }}
  annotations:
    "helm.sh/hook": pre-install,pre-upgrade
    "helm.sh/hook-weight": "-10"
    "helm.sh/hook-delete-policy": before-hook-creation,hook-succeeded
type: Opaque
data:
  SECUREYEOMAN_SIGNING_KEY: {{ .Values.secrets.signingKey | b64enc | quote }}
  SECUREYEOMAN_TOKEN_SECRET: {{ .Values.secrets.tokenSecret | b64enc | quote }}
  SECUREYEOMAN_ENCRYPTION_KEY: {{ .Values.secrets.encryptionKey | b64enc | quote }}
  SECUREYEOMAN_ADMIN_PASSWORD: {{ .Values.secrets.adminPassword | b64enc | quote }}
  POSTGRES_PASSWORD: {{ .Values.secrets.postgresPassword | b64enc | quote }}
  {{- if .Values.secrets.anthropicApiKey }}
  ANTHROPIC_API_KEY: {{ .Values.secrets.anthropicApiKey | b64enc | quote }}
  {{- end }}
{{- end }}

groups:
  - name: secureyeoman_alerts
    rules:
      - alert: SecureYeomanHighErrorRate
        expr: rate(secureyeoman_api_errors_total[5m]) / rate(secureyeoman_api_calls_total[5m]) > 0.05
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "SecureYeoman API error rate is above 5%"
          description: "API error rate is {{ $value | humanizePercentage }} over the last 5 minutes."

      - alert: SecureYeomanHighLatency
        expr: secureyeoman_api_latency_avg_ms > 500
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "SecureYeoman API latency is high"
          description: "Average API latency is {{ $value }}ms."

      - alert: SecureYeomanHighMemory
        expr: secureyeoman_memory_used_mb > 512
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "SecureYeoman memory usage is high"
          description: "Memory usage is {{ $value }}MB."

      - alert: SecureYeomanTaskQueueBacklog
        expr: secureyeoman_tasks_queue_depth > 100
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "SecureYeoman task queue backlog is growing"
          description: "Task queue depth is {{ $value }}."

      - alert: SecureYeomanAuditChainInvalid
        expr: secureyeoman_audit_chain_valid == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "SecureYeoman audit chain integrity failure"
          description: "Audit chain verification has failed. Possible data tampering."

      - alert: SecureYeomanRateLimitSpike
        expr: rate(secureyeoman_rate_limit_hits_total[5m]) > 10
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "SecureYeoman rate limiting is triggering frequently"
          description: "Rate limit hits: {{ $value }} per second."

      - alert: SecureYeomanDown
        expr: up{job="secureyeoman"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "SecureYeoman is down"
          description: "SecureYeoman has been unreachable for more than 1 minute."

      - alert: SecureYeomanAuthFailureSpike
        expr: rate(secureyeoman_auth_failures_total[5m]) > 5
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High authentication failure rate"
          description: "Auth failures: {{ $value }} per second. Possible brute force attack."

      - alert: SecureYeomanHighCost
        expr: secureyeoman_cost_usd_today > 50
        for: 1m
        labels:
          severity: warning
        annotations:
          summary: "SecureYeoman daily cost exceeds $50"
          description: "Current daily cost: ${{ $value }}."
